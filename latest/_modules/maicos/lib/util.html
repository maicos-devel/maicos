<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <link rel="shortcut icon" href="../../../_static/logo.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>maicos.lib.util - MAICoS</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">MAICoS</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logo_MAICOS_light.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../../_static/logo_MAICOS_dark.svg" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../get-started/index.html">Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/maicos.html">What is MAICoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/usage-python.html">Usage - Python interpreter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/usage-bash.html">Usage - command line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/units.html">Some conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/changelog.html">Changelog</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../examples/index.html">How-to guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of How-to guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/usage-bash.html">Usage - command line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/chemical-potential.html">Ideal component of the chemical potential</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/pair-distribution-functions.html">Pair distribution functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/dielectric-profiles.html">Dielectric profile calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/saxs.html">Small-angle X-ray scattering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/usage-python.html">Usage - Python interpreter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/dipole-correlations.html">Calculating and interpreting dipolar pair correlation functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../analysis-modules/index.html">Analysis modules</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Analysis modules</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/densitycylinder.html">DensityCylinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/densityplanar.html">DensityPlanar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/densitysphere.html">DensitySphere</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/dielectriccylinder.html">DielectricCylinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/dielectricplanar.html">DielectricPlanar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/dielectricspectrum.html">DielectricSpectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/dielectricsphere.html">DielectricSphere</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/dipoleangle.html">DipoleAngle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/dipordercylinder.html">DiporderCylinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/diporderplanar.html">DiporderPlanar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/dipordersphere.html">DiporderSphere</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/diporderstructurefactor.html">DiporderStructureFactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/kineticenergy.html">KineticEnergy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/pdfcylinder.html">PDFCylinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/pdfplanar.html">PDFPlanar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/rdfdiporder.html">RDFDiporder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/saxs.html">Saxs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/temperatureplanar.html">TemperaturePlanar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/velocitycylinder.html">VelocityCylinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../analysis-modules/velocityplanar.html">VelocityPlanar</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api-documentation/index.html">API documentation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of API documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api-documentation/core.html">Core classes</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Core classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api-documentation/base/index.html">Base classes</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Base classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api-documentation/base/analysisbase.html">AnalysisBase</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api-documentation/base/analysiscollection.html">AnalysisCollection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api-documentation/base/profilebase.html">ProfileBase</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api-documentation/planar/index.html">Planar classes</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Planar classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api-documentation/planar/planarbase.html">PlanarBase</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api-documentation/planar/profileplanarbase.html">ProfilePlanarBase</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api-documentation/cylinder/index.html">Cylinder classes</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Cylinder classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api-documentation/cylinder/cylinderbase.html">CylinderBase</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api-documentation/cylinder/profilecylinderbase.html">ProfileCylinderBase</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api-documentation/sphere/index.html">Sphere classes</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Sphere classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api-documentation/sphere/spherebase.html">SphereBase</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api-documentation/sphere/profilespherebase.html">ProfileSphereBase</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api-documentation/lib.html">Library functions</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Library functions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api-documentation/math.html">Mathematical helper functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api-documentation/util.html">General helper functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api-documentation/weights.html">Weighting functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api-documentation/tables.html">Tables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../concepts-explanations/index.html">Concepts &amp; explanations</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Concepts &amp; explanations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../concepts-explanations/general-design.html">General design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../concepts-explanations/dielectric.html">Dielectric constant measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../concepts-explanations/saxs.html">Small-angle X-ray scattering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../concepts-explanations/pdfs.html">Pair distribution functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../devdoc/index.html">Developer documentation</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Developer documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../devdoc/own_module.html">Contributing your own analysis module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../devdoc/tests.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../devdoc/documentation.html">Contributing to the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../devdoc/versioning.html">Version information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../devdoc/release.html">Release workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Contributors</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for maicos.lib.util</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2025 Authors and contributors</span>
<span class="c1"># (see the AUTHORS.rst file for the full list of names)</span>
<span class="c1">#</span>
<span class="c1"># Released under the GNU Public Licence, v3 or any higher version</span>
<span class="c1"># SPDX-License-Identifier: GPL-3.0-or-later</span>
<span class="sd">&quot;&quot;&quot;Small helper and utilities functions that don&#39;t fit anywhere else.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Protocol</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">MDAnalysis</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mda</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_peaks</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">maicos.lib.math</span><span class="w"> </span><span class="kn">import</span> <span class="n">correlation_time</span>

<span class="n">DOC_REGEX_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\$\{([^\}]+)\}&quot;</span><span class="p">)</span>

<span class="n">DOC_DICT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="c1">#####################</span>
    <span class="c1"># DESCRIPTION SECTION</span>
    <span class="c1">#####################</span>
    <span class="n">SAVE_METHOD_DESCRIPTION</span><span class="o">=</span><span class="s2">&quot;Save results of analysis to file specified by ``output``.&quot;</span><span class="p">,</span>
    <span class="n">DENSITY_DESCRIPTION_1</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;Calculations are carried out for ``mass``</span>
<span class="s2">:math:`(\rm u \cdot Å^{-3})`, ``number`` :math:`(\rm Å^{-3})`, partial ``charge``</span>
<span class="s2">:math:`(\rm e \cdot Å^{-3})` or electron :math:`(\rm e \cdot Å^{-3})` density</span>
<span class="s2">profiles &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">DENSITY_DESCRIPTION_2</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Cell dimensions are allowed to fluctuate in time.</span>

<span class="s2">For grouping with respect to ``molecules``, ``residues`` etc., the corresponding</span>
<span class="s2">centers (i.e., center of mass), taking into account periodic boundary conditions,</span>
<span class="s2">are calculated. For these calculations molecules will be unwrapped/made whole.</span>
<span class="s2">Trajectories containing already whole molecules can be run with ``unwrap=False`` to</span>
<span class="s2">gain a speedup. For grouping with respect to atoms, the ``unwrap`` option is always</span>
<span class="s2">ignored.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PLANAR_DESCRIPTION</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;along certain cartesian axes ``[x, y, z]`` of the simulation</span>
<span class="s2">cell.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">CYLINDRICAL_DESCRIPTION</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;along the radial axis in a cylindrical coordinate system,</span>
<span class="s2">with principal axis along ``[x, y, z]`` axes of the simulation cell. The origin of the</span>
<span class="s2">coordinate system defaults to the box center, but can be set to dynamically follow the</span>
<span class="s2">center of mass of a reference group via ``refgroup``&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">SPHERICAL_DESCRIPTION</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;along radial axis in spherical coordinate system. The</span>
<span class="s2">origin of the coordinate system defaults to the box center, but can be set to</span>
<span class="s2">dynamically follow the center of mass of a reference group via `refgroup`.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">DENSITY_PLANAR_DESCRIPTION</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{DENSITY_DESCRIPTION_1}</span>
<span class="s2">$</span><span class="si">{PLANAR_DESCRIPTION}</span>
<span class="s2">$</span><span class="si">{DENSITY_DESCRIPTION_2}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">DENSITY_CYLINDER_DESCRIPTION</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{DENSITY_DESCRIPTION_1}</span>
<span class="s2">$</span><span class="si">{CYLINDRICAL_DESCRIPTION}</span>
<span class="s2">$</span><span class="si">{DENSITY_DESCRIPTION_2}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">DENSITY_SPHERE_DESCRIPTION</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{DENSITY_DESCRIPTION_1}</span>
<span class="s2">$</span><span class="si">{SPHERICAL_DESCRIPTION}</span>
<span class="s2">$</span><span class="si">{DENSITY_DESCRIPTION_2}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">DIPORDER_DESCRIPTION</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;Calculations include the projected dipole density</span>
<span class="s2">:math:`P_0⋅ρ(z)⋅\cos(θ[z])`, the dipole orientation :math:`\cos(θ[z])`, the squared</span>
<span class="s2">dipole orientation :math:`\cos²(Θ[z])` and the number density :math:`ρ(z)`.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">CORRELATION_INFO</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;For further information on the correlation analysis please</span>
<span class="s2">refer to :class:`AnalysisBase &lt;maicos.core.base.AnalysisBase&gt;` or the</span>
<span class="s2">:ref:`general-design` section.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">CORRELATION_INFO_PLANAR</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;For the correlation analysis the central bin</span>
<span class="s2">(:math:`N / 2`) of the 0th&#39;s group profile is used. $</span><span class="si">{CORRELATION_INFO}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">CORRELATION_INFO_RADIAL</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;For the correlation analysis the 0th bin of the 0th&#39;s</span>
<span class="s2">group profile is used. $</span><span class="si">{CORRELATION_INFO}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">RUN_METHOD_DESCRIPTION</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Iterate over the trajectory.</span>

<span class="s2">Parameters</span>
<span class="s2">----------</span>
<span class="s2">start : int</span>
<span class="s2">    start frame of analysis</span>
<span class="s2">stop : int</span>
<span class="s2">    stop frame of analysis</span>
<span class="s2">step : int</span>
<span class="s2">    number of frames to skip between each analysed frame</span>
<span class="s2">frames : array_like</span>
<span class="s2">    array of integers or booleans to slice trajectory; ``frames`` can only be</span>
<span class="s2">    used *instead* of ``start``, ``stop``, and ``step``. Setting *both*</span>
<span class="s2">    ``frames`` and at least one of ``start``, ``stop``, ``step`` to a</span>
<span class="s2">    non-default value will raise a :exc:`ValueError`.</span>
<span class="s2">verbose : bool</span>
<span class="s2">    Turn on verbosity</span>
<span class="s2">progressbar_kwargs : dict</span>
<span class="s2">    ProgressBar keywords with custom parameters regarding progress bar position,</span>
<span class="s2">    etc; see :class:`MDAnalysis.lib.log.ProgressBar` for full list.</span>

<span class="s2">Returns</span>
<span class="s2">-------</span>
<span class="s2">self : object</span>
<span class="s2">    analysis object</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="c1">##########################</span>
    <span class="c1"># SINGLE PARAMETER SECTION</span>
    <span class="c1">##########################</span>
    <span class="n">ATOMGROUP_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;atomgroup : MDAnalysis.core.groups.AtomGroup</span>
<span class="s2">    A :class:`~MDAnalysis.core.groups.AtomGroup` for which the calculations are</span>
<span class="s2">    performed.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">WRAP_COMPOUND_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;wrap_compound : str</span>
<span class="s2">    The group which will be kept together through the wrap processes. Allowed values</span>
<span class="s2">    are: ``&quot;atoms&quot;``, ``&quot;group&quot;``, ``&quot;residues&quot;``, ``&quot;segments&quot;``, ``&quot;molecules&quot;``, or</span>
<span class="s2">    ``&quot;fragments&quot;``.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">DENS_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;dens : {``&quot;mass&quot;``, ``&quot;number&quot;``, ``&quot;charge&quot;``, ``&quot;electron&quot;``}</span>
<span class="s2">    density type to be calculated.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">TEMPERATURE_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;temperature : float</span>
<span class="s2">    Reference temperature (K)&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">BIN_WIDTH_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;bin_width : float</span>
<span class="s2">    Width of the bins (in Å).&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">DIM_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;dim : {0, 1, 2}</span>
<span class="s2">    Dimension for binning (``x=0``, ``y=1``, ``z=1``).&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">VDIM_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;vdim : {0, 1, 2}</span>
<span class="s2">    Dimension for velocity binning (``x=0``, ``y=1``, ``z=1``).&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PDIM_PLANAR_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;pdim : {0, 1, 2}</span>
<span class="s2">    direction of the projection&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PDIM_RADIAL_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;pdim : {``&quot;r&quot;``, ``&quot;z&quot;``}</span>
<span class="s2">    direction of the projection&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">FLUX_PARAMETER</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;flux : bool</span>
<span class="s2">    Calculate the flux (:math:`[Å^2/\mathrm</span><span class="si">{ps}</span><span class="s2">]`) instead of the velocity.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">GROUPING_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;grouping : {``&quot;atoms&quot;``, ``&quot;residues&quot;``, ``&quot;segments&quot;``, ``&quot;molecules&quot;``, ``&quot;fragments&quot;``}</span>
<span class="s2">    Atom grouping for the calculations.</span>

<span class="s2">    The possible grouping options are the atom positions (in the case where</span>
<span class="s2">    ``grouping=&quot;atoms&quot;``) or the center of mass of the specified grouping unit (in the</span>
<span class="s2">    case where ``grouping=&quot;residues&quot;``, ``&quot;segments&quot;``, ``&quot;molecules&quot;`` or</span>
<span class="s2">    ``&quot;fragments&quot;``).&quot;&quot;&quot;</span><span class="p">,</span>  <span class="c1"># noqa: E501</span>
    <span class="n">OUTPUT_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;output : str</span>
<span class="s2">    Output filename.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">OUTPUT_PREFIX_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;output_prefix : str</span>
<span class="s2">    Prefix for output files.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">SYM_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;sym : bool</span>
<span class="s2">    Symmetrize the profile. Only works in combination with ``refgroup``.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">BIN_METHOD_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;bin_method : {``&quot;com&quot;``, ``&quot;cog&quot;``, ``&quot;coc&quot;``}</span>
<span class="s2">    Method for the position binning.</span>

<span class="s2">    The possible options are center of mass (``&quot;com&quot;``), center of geometry (``&quot;cog&quot;``),</span>
<span class="s2">    and center of charge (``&quot;coc&quot;``).&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">ORDER_PARAMETER_PARAMETER</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;order_parameter : {``&quot;P0&quot;``, ``&quot;cos_theta&quot;``, ``&quot;cos_2_theta&quot;``}</span>
<span class="s2">    Order parameter to be calculated:</span>
<span class="s2">        - ``&quot;P0&quot;``: total dipole moment projected on an axis</span>
<span class="s2">        - ``&quot;cos_theta&quot;``: cosine of the dipole moment with an axis</span>
<span class="s2">        - ``&quot;cos_2_theta&quot;``: squred cosine with an axis.&quot;&quot;&quot;</span><span class="p">,</span>  <span class="c1"># noqa: E501</span>
    <span class="c1">###################################</span>
    <span class="c1"># MULTI/COMBINES PARAMETERS SECTION</span>
    <span class="c1">###################################</span>
    <span class="n">BASE_CLASS_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;unwrap : bool</span>
<span class="s2">    When :obj:`True`, molecules that are broken due to the periodic boundary conditions</span>
<span class="s2">    are made whole.</span>

<span class="s2">    If the input contains molecules that are already whole, speed up the calculation by</span>
<span class="s2">    disabling unwrap. To do so, use the flag ``-no-unwrap`` when using MAICoS from the</span>
<span class="s2">    command line, or use ``unwrap=False`` when using MAICoS from the Python interpreter.</span>

<span class="s2">    Note: Molecules containing virtual sites (e.g. TIP4P water models) are not currently</span>
<span class="s2">    supported in MDAnalysis. In this case, you need to provide unwrapped trajectory</span>
<span class="s2">    files directly, and disable unwrap. Trajectories can be unwrapped, for example,</span>
<span class="s2">    using the ``trjconv`` command of GROMACS.</span>
<span class="s2">pack : bool</span>
<span class="s2">    When :obj:`True`, molecules are put back into the unit cell. This is required</span>
<span class="s2">    because MAICoS only takes into account molecules that are inside the unit cell.</span>

<span class="s2">    If the input contains molecules that are already packed, speed up the calculation by</span>
<span class="s2">    disabling packing with ``pack=False``.</span>
<span class="s2">refgroup : MDAnalysis.core.groups.AtomGroup</span>
<span class="s2">    Reference :class:`~MDAnalysis.core.groups.AtomGroup` used for the calculation. If</span>
<span class="s2">    ``refgroup`` is provided, the calculation is performed relative to the center of</span>
<span class="s2">    mass of the AtomGroup. If ``refgroup`` is :obj:`None` the calculations are performed</span>
<span class="s2">    with respect to the center of the (changing) box.</span>
<span class="s2">jitter : float</span>
<span class="s2">    Magnitude of the random noise to add to the atomic positions.</span>

<span class="s2">    A jitter can be used to stabilize the aliasing effects sometimes appearing when</span>
<span class="s2">    histogramming data. The jitter value should be about the precision of the</span>
<span class="s2">    trajectory. In that case, using jitter will not alter the results of the histogram.</span>
<span class="s2">    If ``jitter = 0.0`` (default), the original atomic positions are kept unchanged.</span>

<span class="s2">    You can estimate the precision of the positions in your trajectory with</span>
<span class="s2">    :func:`maicos.lib.util.trajectory_precision`. Note that if the precision is not the</span>
<span class="s2">    same for all frames, the smallest precision should be used.</span>
<span class="s2">concfreq : int</span>
<span class="s2">    When concfreq (for conclude frequency) is larger than ``0``, the conclude function</span>
<span class="s2">    is called and the output files are written every ``concfreq`` frames.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PROFILE_CLASS_PARAMETERS_PRIVATE</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;weighting_function : callable</span>
<span class="s2">    The function calculating the array weights for the histogram analysis. It must take</span>
<span class="s2">    an :py:class:`AtomGroup&lt;MDAnalysis.AtomGroup&gt;` as first argument and a grouping</span>
<span class="s2">    (``&quot;atoms&quot;``, ``&quot;residues&quot;``, ``&quot;segments&quot;``, ``&quot;molecules&quot;``, ``&quot;fragments&quot;``) as</span>
<span class="s2">    second. Additional parameters can be given as ``weighting_function_kwargs``. The</span>
<span class="s2">    function must return a numpy.ndarray with the same length as the number of group</span>
<span class="s2">    members.</span>
<span class="s2">weighting_function_kwargs : dict</span>
<span class="s2">    Additional keyword arguments for ``weighting_function``</span>
<span class="s2">normalization : {``&quot;none&quot;``, ``&quot;number&quot;``, ``&quot;volume&quot;``}</span>
<span class="s2">    The normalization of the profile performed in every frame. If :obj:`None`, no</span>
<span class="s2">    normalization is performed. If `number`, the histogram is divided by the number of</span>
<span class="s2">    occurences in each bin. If `volume`, the profile is divided by the volume of each</span>
<span class="s2">    bin.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">Q_SPACE_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;qmin : float</span>
<span class="s2">    Starting q (1/Å)</span>
<span class="s2">qmax : float</span>
<span class="s2">    Ending q (1/Å)</span>
<span class="s2">dq : float</span>
<span class="s2">    bin_width (1/Å)&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PLANAR_CLASS_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{BASE_CLASS_PARAMETERS}</span>
<span class="s2">$</span><span class="si">{DIM_PARAMETER}</span>
<span class="s2">zmin : float</span>
<span class="s2">    Minimal coordinate for evaluation (in Å) with respect to the center of mass of the</span>
<span class="s2">    refgroup.</span>

<span class="s2">    If ``zmin=None``, all coordinates down to the lower cell boundary are taken into</span>
<span class="s2">    account.</span>
<span class="s2">zmax : float</span>
<span class="s2">    Maximal coordinate for evaluation (in Å) with respect to the center of mass of the</span>
<span class="s2">    refgroup.</span>

<span class="s2">    If ``zmax = None``, all coordinates up to the upper cell boundary are taken into</span>
<span class="s2">    account.</span>
<span class="s2">$</span><span class="si">{BIN_WIDTH_PARAMETER}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">RADIAL_CLASS_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;rmin : float</span>
<span class="s2">    Minimal radial coordinate relative to the center of mass of the refgroup for</span>
<span class="s2">    evaluation (in Å).</span>
<span class="s2">rmax : float</span>
<span class="s2">    Maximal radial coordinate relative to the center of mass of the refgroup for</span>
<span class="s2">    evaluation (in Å).</span>

<span class="s2">    If ``rmax=None``, the box extension is taken.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PDF_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;g1 : MDAnalysis.core.groups.AtomGroup</span>
<span class="s2">    First AtomGroup.</span>
<span class="s2">g2 : MDAnalysis.core.groups.AtomGroup</span>
<span class="s2">    Second AtomGroup.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PROFILE_CLASS_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{GROUPING_PARAMETER}</span>
<span class="s2">$</span><span class="si">{BIN_METHOD_PARAMETER}</span>
<span class="s2">$</span><span class="si">{OUTPUT_PARAMETER}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">CYLINDER_CLASS_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{PLANAR_CLASS_PARAMETERS}</span>
<span class="s2">$</span><span class="si">{RADIAL_CLASS_PARAMETERS}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">SPHERE_CLASS_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{BASE_CLASS_PARAMETERS}</span>
<span class="s2">$</span><span class="si">{RADIAL_CLASS_PARAMETERS}</span>
<span class="s2">$</span><span class="si">{BIN_WIDTH_PARAMETER}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PROFILE_PLANAR_CLASS_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{ATOMGROUP_PARAMETER}</span>
<span class="s2">$</span><span class="si">{PLANAR_CLASS_PARAMETERS}</span>
<span class="s2">$</span><span class="si">{SYM_PARAMETER}</span>
<span class="s2">$</span><span class="si">{PROFILE_CLASS_PARAMETERS}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PROFILE_CYLINDER_CLASS_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{ATOMGROUP_PARAMETER}</span>
<span class="s2">$</span><span class="si">{CYLINDER_CLASS_PARAMETERS}</span>
<span class="s2">$</span><span class="si">{PROFILE_CLASS_PARAMETERS}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PROFILE_SPHERE_CLASS_PARAMETERS</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{ATOMGROUP_PARAMETER}</span>
<span class="s2">$</span><span class="si">{SPHERE_CLASS_PARAMETERS}</span>
<span class="s2">$</span><span class="si">{PROFILE_CLASS_PARAMETERS}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="c1">###################</span>
    <span class="c1"># ATTRIBUTE SECTION</span>
    <span class="c1">###################</span>
    <span class="n">PLANAR_CLASS_ATTRIBUTES</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;results.bin_pos : numpy.ndarray</span>
<span class="s2">    Bin positions (in Å) ranging from ``zmin`` to ``zmax``.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">RADIAL_CLASS_ATTRIBUTES</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;results.bin_pos : numpy.ndarray</span>
<span class="s2">    Bin positions (in Å) ranging from ``rmin`` to ``rmax``.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PROFILE_CLASS_ATTRIBUTES</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;results.profile : numpy.ndarray</span>
<span class="s2">    Calculated profile.</span>
<span class="s2">results.dprofile : numpy.ndarray</span>
<span class="s2">    Estimated profile&#39;s uncertainity.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">CYLINDER_CLASS_ATTRIBUTES</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{RADIAL_CLASS_ATTRIBUTES}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">SPHERE_CLASS_ATTRIBUTES</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{RADIAL_CLASS_ATTRIBUTES}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">PROFILE_PLANAR_CLASS_ATTRIBUTES</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{PLANAR_CLASS_ATTRIBUTES}</span>
<span class="s2">$</span><span class="si">{PROFILE_CLASS_ATTRIBUTES}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PROFILE_CYLINDER_CLASS_ATTRIBUTES</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{RADIAL_CLASS_ATTRIBUTES}</span>
<span class="s2">$</span><span class="si">{PROFILE_CLASS_ATTRIBUTES}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">PROFILE_SPHERE_CLASS_ATTRIBUTES</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;$</span><span class="si">{RADIAL_CLASS_ATTRIBUTES}</span>
<span class="s2">$</span><span class="si">{PROFILE_CLASS_ATTRIBUTES}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="sd">&quot;&quot;&quot;Dictionary containing the keys and the actual docstring used by :func:`maicos.lib.util.render_docs`.</span>

<span class="sd">    :meta hide-value:</span>
<span class="sd">&quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_render_docs</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">doc_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">DOC_DICT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">DOC_REGEX_PATTERN</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">break</span>  <span class="c1"># Exit the loop if no more patterns are found</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="se">{{</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">doc_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">func</span>


<div class="viewcode-block" id="render_docs">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.render_docs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">render_docs</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace all template phrases in the functions docstring.</span>

<span class="sd">    Keys for the replacement are taken from in :attr:`maicos.lib.util.DOC_DICT`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : callable</span>
<span class="sd">        The callable (function, class) where the phrase old should be replaced.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Callable</span>
<span class="sd">        callable with replaced phrase</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_render_docs</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">doc_dict</span><span class="o">=</span><span class="n">DOC_DICT</span><span class="p">)</span></div>



<div class="viewcode-block" id="correlation_analysis">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.correlation_analysis">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">correlation_analysis</span><span class="p">(</span><span class="n">timeseries</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Timeseries correlation analysis.</span>

<span class="sd">    Analyses a timeseries for correlation and prints a warning if the correlation time</span>
<span class="sd">    is larger than the step size.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    timeseries : numpy.ndarray</span>
<span class="sd">        Array of (possibly) correlated data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    corrtime: float</span>
<span class="sd">        Estimated correlation time of `timeseries`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">timeseries</span><span class="p">)):</span>
        <span class="c1"># Fail silently if there are NaNs in the timeseries. This is the case if the</span>
        <span class="c1"># feature is not implemented for the given analysis. It could also be because of</span>
        <span class="c1"># a bug, but that is not our business.</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timeseries</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Your trajectory is too short to estimate a correlation time. Use the &quot;</span>
            <span class="s2">&quot;calculated error estimates with caution.&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">corrtime</span> <span class="o">=</span> <span class="n">correlation_time</span><span class="p">(</span><span class="n">timeseries</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">corrtime</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Your trajectory does not provide sufficient statistics to estimate a &quot;</span>
            <span class="s2">&quot;correlation time. Use the calculated error estimates with caution.&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">corrtime</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Your data seems to be correlated with a correlation time which is &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">corrtime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> times larger than your step size. Consider increasing &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;your step size by a factor of </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">corrtime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2"> to get &quot;</span>
            <span class="s2">&quot;a reasonable error estimate.&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">corrtime</span></div>



<div class="viewcode-block" id="get_compound">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.get_compound">[docs]</a>
<span class="nd">@render_docs</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_compound</span><span class="p">(</span><span class="n">atomgroup</span><span class="p">:</span> <span class="n">mda</span><span class="o">.</span><span class="n">AtomGroup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the highest order topology attribute.</span>

<span class="sd">    The order is &quot;molecules&quot;, &quot;fragments&quot;, &quot;residues&quot;. If the topology contains none of</span>
<span class="sd">    those attributes, an AttributeError is raised.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${ATOMGROUP_PARAMETER}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        Name of the topology attribute.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AttributeError</span>
<span class="sd">        `atomgroup` is missing any connection information&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">atomgroup</span><span class="p">,</span> <span class="s2">&quot;molnums&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;molecules&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">atomgroup</span><span class="p">,</span> <span class="s2">&quot;fragments&quot;</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cannot use &#39;molecules&#39;. Falling back to &#39;fragments&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;fragments&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">atomgroup</span><span class="p">,</span> <span class="s2">&quot;residues&quot;</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Cannot use &#39;fragments&#39;. Falling back to &#39;residues&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;residues&quot;</span>
    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Missing any connection information in `atomgroup`.&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_cli_input">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.get_cli_input">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_cli_input</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a proper formatted string of the command line input.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string representing the command line input in a proper format.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">program_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">name</span>
    <span class="c1"># Add additional quotes for connected arguments.</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">arg</span> <span class="k">else</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">program_name</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arguments</span><span class="p">))</span></div>



<div class="viewcode-block" id="atomgroup_header">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.atomgroup_header">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">atomgroup_header</span><span class="p">(</span><span class="n">AtomGroup</span><span class="p">:</span> <span class="n">mda</span><span class="o">.</span><span class="n">AtomGroup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a string containing infos about the AtomGroup.</span>

<span class="sd">    Infos include the total number of atoms, the including residues and the number of</span>
<span class="sd">    residues. Useful for writing output file headers.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    AtomGroup : MDAnalysis.core.groups.AtomGroup</span>
<span class="sd">        The AtomGroup object containing the atoms.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string containing the AtomGroup information.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">AtomGroup</span><span class="p">,</span> <span class="s2">&quot;types&quot;</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;AtomGroup does not contain atom types. Not writing AtomGroup information &quot;</span>
            <span class="s2">&quot;to output.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">AtomGroup</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span><span class="si">}</span><span class="s2"> unkown particles&quot;</span>
    <span class="n">unique</span><span class="p">,</span> <span class="n">unique_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">AtomGroup</span><span class="o">.</span><span class="n">types</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">unique</span><span class="p">,</span> <span class="n">unique_counts</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span></div>



<div class="viewcode-block" id="bin">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.bin">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bin</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Average array values in bins for easier plotting.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : numpy.ndarray</span>
<span class="sd">        The input array to be averaged.</span>
<span class="sd">    bins : numpy.ndarray</span>
<span class="sd">        The array containing the indices where each bin begins.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        The averaged array values.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The &quot;bins&quot; array should contain the INDEX (integer) where each bin begins.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplex</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>  <span class="c1"># average of data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>

    <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">ic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span>
            <span class="n">ic</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># index for new average</span>
        <span class="n">avg</span><span class="p">[</span><span class="n">ic</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">count</span><span class="p">[</span><span class="n">ic</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">avg</span> <span class="o">/</span> <span class="n">count</span></div>



<div class="viewcode-block" id="charge_neutral">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.charge_neutral">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">charge_neutral</span><span class="p">(</span><span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raise a Warning when AtomGroup is not charge neutral.</span>

<span class="sd">    Class Decorator to raise an Error/Warning when AtomGroup in an AnalysisBase class is</span>
<span class="sd">    not charge neutral. The behaviour of the warning can be controlled with the filter</span>
<span class="sd">    attribute. If the AtomGroup&#39;s corresponding universe is non-neutral an ValueError is</span>
<span class="sd">    raised.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filter : str</span>
<span class="sd">        Filter type to control warning filter. Common values are: &quot;error&quot; or &quot;default&quot;</span>
<span class="sd">        See `warnings.simplefilter` for more options.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">inner</span><span class="p">(</span><span class="n">original_class</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">charge_check</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atomgroup</span><span class="o">.</span><span class="n">total_charge</span><span class="p">(</span><span class="n">compound</span><span class="o">=</span><span class="n">get_compound</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomgroup</span><span class="p">)),</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="n">atol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                            <span class="s2">&quot;At least one AtomGroup has free charges. Analysis for &quot;</span>
                            <span class="s2">&quot;systems with free charges could lead to severe &quot;</span>
                            <span class="s2">&quot;artifacts!&quot;</span><span class="p">,</span>
                            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atomgroup</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">total_charge</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-4</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Analysis for non-neutral systems is not supported.&quot;</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">wrapped</span>

        <span class="n">original_class</span><span class="o">.</span><span class="n">_prepare</span> <span class="o">=</span> <span class="n">charge_check</span><span class="p">(</span><span class="n">original_class</span><span class="o">.</span><span class="n">_prepare</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">original_class</span>

    <span class="k">return</span> <span class="n">inner</span></div>



<div class="viewcode-block" id="unwrap_refgroup">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.unwrap_refgroup">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">unwrap_refgroup</span><span class="p">(</span><span class="n">original_class</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class decorator error if `unwrap = False` and `refgroup != None`.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unwrap_check</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">unwrap_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;unwrap&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;refgroup&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">unwrap</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">refgroup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Analysis using `unwrap=False` and `refgroup != None` can lead &quot;</span>
                    <span class="s2">&quot;to broken molecules and severe errors.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">unwrap_check</span>

    <span class="n">original_class</span><span class="o">.</span><span class="n">_prepare</span> <span class="o">=</span> <span class="n">unwrap_check</span><span class="p">(</span><span class="n">original_class</span><span class="o">.</span><span class="n">_prepare</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">original_class</span></div>



<div class="viewcode-block" id="trajectory_precision">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.trajectory_precision">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trajectory_precision</span><span class="p">(</span>
    <span class="n">trajectory</span><span class="p">:</span> <span class="n">mda</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">ReaderBase</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect the precision of a trajectory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    trajectory : MDAnalysis.coordinates.base.ReaderBase</span>
<span class="sd">        Trajectory from which the precision is detected.</span>
<span class="sd">    dim : {2, 0, 1}</span>
<span class="sd">        Dimension along which the precision is detected.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    precision : numpy.ndarray</span>
<span class="sd">        Precision of each frame of the trajectory.</span>

<span class="sd">        If the trajectory has a high precision, its resolution will not be detected, and</span>
<span class="sd">        a value of 1e-4 is returned.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The threshold will limit the precision of the detection. Using a value that is too</span>
    <span class="c1"># low will end up costing a lot of memory. 1e-4 is enough to safely detect the</span>
    <span class="c1"># resolution of format like XTC</span>
    <span class="n">threshold_bin_width</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">n_frames</span><span class="p">)</span>
    <span class="c1"># to be done, add range=(0, -1, 1) parameter for ts in</span>
    <span class="c1"># trajectory[range[0]:range[1]:range[2]]:</span>
    <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">trajectory</span><span class="p">:</span>
        <span class="n">n_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="n">dim</span><span class="p">])</span>
                    <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="n">dim</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="n">threshold_bin_width</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">hist1</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="n">dim</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">hist2</span><span class="p">,</span>
            <span class="n">bin_edges</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">hist1</span><span class="p">)]),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">hist2</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">hist2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="mf">5e-4</span><span class="p">:</span>
            <span class="n">precision</span><span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">precision</span><span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">hist2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">precision</span></div>



<span class="n">DOI_LIST</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;10.1103/PhysRevLett.117.048001&quot;</span><span class="p">:</span> <span class="s2">&quot;Schlaich, A. et al., Phys. Rev. Lett. 117, &quot;</span>
    <span class="s2">&quot;(2016).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;10.1021/acs.jpcb.9b09269&quot;</span><span class="p">:</span> <span class="s2">&quot;Loche, P. et al., J. Phys. Chem. B 123, (2019).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;10.1021/acs.jpca.0c04063&quot;</span><span class="p">:</span> <span class="s2">&quot;Carlson, S. et al., J. Phys. Chem. A 124, (2020).&quot;</span><span class="p">,</span>
    <span class="s2">&quot;10.1103/PhysRevE.92.032718&quot;</span><span class="p">:</span> <span class="s2">&quot;Schaaf, C. et al., Phys. Rev. E 92, (2015).&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;References associated with MAICoS</span>

<span class="sd">    :meta hide-value:</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="citation_reminder">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.citation_reminder">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">citation_reminder</span><span class="p">(</span><span class="o">*</span><span class="n">dois</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prints citations in order to remind users to give due credit.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dois : list</span>
<span class="sd">        dois associated with the method which calls this. Possible dois are registered</span>
<span class="sd">        in :attr:`maicos.lib.util.DOI_LIST`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cite : str</span>
<span class="sd">        formatted citation reminders</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cite</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">doi</span> <span class="ow">in</span> <span class="n">dois</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;If you use this module in your work, please read and cite:&quot;</span><span class="p">,</span>
            <span class="n">DOI_LIST</span><span class="p">[</span><span class="n">doi</span><span class="p">],</span>
            <span class="sa">f</span><span class="s2">&quot;doi: </span><span class="si">{</span><span class="n">doi</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">plus</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">lines</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="s1">&#39;+&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">plus</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plus</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">cite</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cite</span></div>



<div class="viewcode-block" id="get_center">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.get_center">[docs]</a>
<span class="nd">@render_docs</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_center</span><span class="p">(</span><span class="n">atomgroup</span><span class="p">:</span> <span class="n">mda</span><span class="o">.</span><span class="n">AtomGroup</span><span class="p">,</span> <span class="n">bin_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">compound</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Center attribute for an :class:`MDAnalysis.core.groups.AtomGroup`.</span>

<span class="sd">    This function acts as a wrapper for the</span>
<span class="sd">    :meth:`MDAnalysis.core.groups.AtomGroup.center` method, providing a more</span>
<span class="sd">    user-friendly interface by automatically determining the appropriate weights based</span>
<span class="sd">    on the chosen binning method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${ATOMGROUP_PARAMETER}</span>
<span class="sd">    ${BIN_METHOD_PARAMETER}</span>
<span class="sd">    compound : {``&quot;group&quot;``, ``&quot;segments&quot;``, ``&quot;residues&quot;``, ``&quot;molecules&quot;``, ``&quot;fragments&quot;``}</span>
<span class="sd">        The compound to be used in the center calculation. For example, ``&quot;residue&quot;``,</span>
<span class="sd">        ``&quot;segment&quot;``, etc.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        The coordinates of the calculated center.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the provided ``bin_method`` is not one of {``&quot;com&quot;``, ``&quot;cog&quot;``, ``&quot;coc&quot;``}.</span>

<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="k">if</span> <span class="n">bin_method</span> <span class="o">==</span> <span class="s2">&quot;cog&quot;</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">bin_method</span> <span class="o">==</span> <span class="s2">&quot;com&quot;</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">atomgroup</span><span class="o">.</span><span class="n">masses</span>
    <span class="k">elif</span> <span class="n">bin_method</span> <span class="o">==</span> <span class="s2">&quot;coc&quot;</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">atomgroup</span><span class="o">.</span><span class="n">charges</span><span class="o">.</span><span class="fm">__abs__</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">bin_method</span><span class="si">}</span><span class="s2">&#39; is an unknown binning method. Use &#39;cog&#39;, &#39;com&#39; or &#39;coc&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">atomgroup</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">compound</span><span class="o">=</span><span class="n">compound</span><span class="p">)</span></div>



<div class="viewcode-block" id="unit_vectors_planar">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.unit_vectors_planar">[docs]</a>
<span class="nd">@render_docs</span>
<span class="k">def</span><span class="w"> </span><span class="nf">unit_vectors_planar</span><span class="p">(</span>
    <span class="n">atomgroup</span><span class="p">:</span> <span class="n">mda</span><span class="o">.</span><span class="n">AtomGroup</span><span class="p">,</span>  <span class="c1"># noqa: ARG001</span>
    <span class="n">grouping</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>  <span class="c1"># noqa: ARG001</span>
    <span class="n">pdim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate unit vectors in planar geometry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${ATOMGROUP_PARAMETER}</span>
<span class="sd">    ${GROUPING_PARAMETER}</span>
<span class="sd">    ${PDIM_PLANAR_PARAMETER}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        the unit vector</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">unit_vectors</span><span class="p">[</span><span class="n">pdim</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">unit_vectors</span></div>



<div class="viewcode-block" id="unit_vectors_cylinder">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.unit_vectors_cylinder">[docs]</a>
<span class="nd">@render_docs</span>
<span class="k">def</span><span class="w"> </span><span class="nf">unit_vectors_cylinder</span><span class="p">(</span>
    <span class="n">atomgroup</span><span class="p">:</span> <span class="n">mda</span><span class="o">.</span><span class="n">AtomGroup</span><span class="p">,</span>
    <span class="n">grouping</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">bin_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">pdim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate cylindrical unit vectors in cartesian coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${ATOMGROUP_PARAMETER}</span>
<span class="sd">    ${GROUPING_PARAMETER}</span>
<span class="sd">    ${BIN_METHOD_PARAMETER}</span>
<span class="sd">    ${DIM_PARAMETER}</span>
<span class="sd">    ${PDIM_RADIAL_PARAMETER}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Array of the calculated unit vectors with shape (3,) for `pdim=&#39;z&#39;` and shape</span>
<span class="sd">        (3,n) for `pdim=&#39;r&#39;`. The length of `n` depends on the grouping.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We do NOT transform ``unit_vectors`` into cylindrical coordinates, because all</span>
    <span class="c1"># scalar products in ``dipolar_weights`` will be performed cartesian coordinates!</span>
    <span class="k">if</span> <span class="n">pdim</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
        <span class="n">unit_vectors</span> <span class="o">=</span> <span class="n">get_center</span><span class="p">(</span>
            <span class="n">atomgroup</span><span class="o">=</span><span class="n">atomgroup</span><span class="p">,</span> <span class="n">bin_method</span><span class="o">=</span><span class="n">bin_method</span><span class="p">,</span> <span class="n">compound</span><span class="o">=</span><span class="n">grouping</span>
        <span class="p">)</span>

        <span class="n">unit_vectors</span> <span class="o">-=</span> <span class="n">atomgroup</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># set z direction to zero. r in cylindrical coordinates contains only x and y.</span>
        <span class="n">unit_vectors</span><span class="p">[:,</span> <span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">unit_vectors</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">unit_vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">pdim</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>
        <span class="n">unit_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">unit_vectors</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">pdim</span><span class="si">}</span><span class="s2">&#39; is an unknown direction for the projection. Use &#39;r&#39; or &#39;z&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">unit_vectors</span></div>



<div class="viewcode-block" id="unit_vectors_sphere">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.unit_vectors_sphere">[docs]</a>
<span class="nd">@render_docs</span>
<span class="k">def</span><span class="w"> </span><span class="nf">unit_vectors_sphere</span><span class="p">(</span>
    <span class="n">atomgroup</span><span class="p">:</span> <span class="n">mda</span><span class="o">.</span><span class="n">AtomGroup</span><span class="p">,</span> <span class="n">grouping</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_method</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate spherical unit vectors in cartesian coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ${ATOMGROUP_PARAMETER}</span>
<span class="sd">    ${GROUPING_PARAMETER}</span>
<span class="sd">    ${BIN_METHOD_PARAMETER}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Array of the calculated unit vectors with shape (3,n). The length of `n`</span>
<span class="sd">        depends on the grouping.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We do NOT transform ``unit_vectors`` into spherical coordinates, because all</span>
    <span class="c1"># scalar products in ``dipolar_weights`` will be performed cartesian coordinates!</span>
    <span class="n">unit_vectors</span> <span class="o">=</span> <span class="n">get_center</span><span class="p">(</span>
        <span class="n">atomgroup</span><span class="o">=</span><span class="n">atomgroup</span><span class="p">,</span> <span class="n">bin_method</span><span class="o">=</span><span class="n">bin_method</span><span class="p">,</span> <span class="n">compound</span><span class="o">=</span><span class="n">grouping</span>
    <span class="p">)</span>

    <span class="c1"># shift origin to box center and afterwards normalize</span>
    <span class="n">unit_vectors</span> <span class="o">-=</span> <span class="n">atomgroup</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">unit_vectors</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">unit_vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">unit_vectors</span></div>



<div class="viewcode-block" id="maicos_banner">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.maicos_banner">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">maicos_banner</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">frame_char</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prints ASCII banner resembling the MAICoS Logo with 80 chars width.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    version : str</span>
<span class="sd">        Version string to add to the banner.</span>
<span class="sd">    frame_char : str</span>
<span class="sd">        Character used to as framing around the banner.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    banner : str</span>
<span class="sd">        formatted banner</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">banner</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span>
<span class="s2">@                  __  __              _____    _____            _____         @</span>
<span class="s2">@    ()----()     |  \/  |     /\     |_   _|  / ____|          / ____|        @</span>
<span class="s2">@   /  |     \    | \  / |    /  \      | |   | |        ___   | (___          @</span>
<span class="s2">@  () ||| |  ()   | |\/| |   / /\ \     | |   | |       / _ \   \___ \         @</span>
<span class="s2">@   \ |||||_ /    | |  | |  / ____ \   _| |_  | |____  | (_) |  ____) |        @</span>
<span class="s2">@    ()----()     |_|  |_| /_/    \_\ |_____|  \_____|  \___/  |_____/ </span><span class="si">{</span><span class="n">version</span><span class="si">:</span><span class="s2">^8</span><span class="si">}</span><span class="s2">@</span>
<span class="s2">@                                                                              @</span>
<span class="s2">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span>
<span class="s2">&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">banner</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="n">frame_char</span><span class="p">)</span></div>



<div class="viewcode-block" id="Unit_vector">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.Unit_vector">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Unit_vector</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Protocol class for unit vector methods type hints.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomgroup</span><span class="p">:</span> <span class="n">mda</span><span class="o">.</span><span class="n">AtomGroup</span><span class="p">,</span> <span class="n">grouping</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call for type hints.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>



<div class="viewcode-block" id="get_module_input_str">
<a class="viewcode-back" href="../../../api-documentation/util.html#maicos.lib.util.get_module_input_str">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_module_input_str</span><span class="p">(</span><span class="n">module_obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a string with all the modules parameters.&quot;&quot;&quot;</span>
    <span class="n">module_name</span> <span class="o">=</span> <span class="n">module_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="c1"># We have to check this since only the modules have the _locals attribute,</span>
    <span class="c1"># not the base classes. Yet we still want to test output behaviour of the base</span>
    <span class="c1"># classes.</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module_obj</span><span class="p">,</span> <span class="s2">&quot;_locals&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module_obj</span><span class="p">,</span> <span class="s2">&quot;_run_locals&quot;</span><span class="p">):</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">module_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="n">sig</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">module_obj</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="n">param</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">module_obj</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">param</span> <span class="o">==</span> <span class="s2">&quot;atomgroup&quot;</span>
                <span class="ow">or</span> <span class="n">param</span> <span class="o">==</span> <span class="s2">&quot;refgroup&quot;</span>
                <span class="ow">and</span> <span class="n">module_obj</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">=&lt;AtomGroup&gt;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">module_obj</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="n">init_signature</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>

        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">module_obj</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
        <span class="n">sig</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
        <span class="n">run_signature</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">module_obj</span><span class="o">.</span><span class="n">_run_locals</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">module_obj</span><span class="o">.</span><span class="n">_run_locals</span><span class="p">[</span><span class="n">param</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span>
                    <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">module_obj</span><span class="o">.</span><span class="n">_run_locals</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">args</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="n">module_input</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">init_signature</span><span class="si">}</span><span class="s2">).run(</span><span class="si">{</span><span class="n">run_signature</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">module_input</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">(*args).run(*args)&quot;</span>

    <span class="k">return</span> <span class="n">module_input</span></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, MAICoS Developer Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link fa-brands fa-github fa-2x" href="https://github.com/maicos-devel/maicos" aria-label="GitHub"></a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=8a448e45"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../../_static/toggleprompt.js?v=5801b3bb"></script>
    </body>
</html>